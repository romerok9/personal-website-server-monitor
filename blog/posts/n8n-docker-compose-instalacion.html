<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Self-Hosted: Instalaci√≥n Completa con Docker Compose | Kevin Romero</title>
    <meta name="description" content="Gu√≠a completa para instalar n8n con Docker Compose, PostgreSQL y Nginx. Troubleshooting de ECONNREFUSED y configuraci√≥n √≥ptima.">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.7;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .back-link {
            display: inline-block;
            color: #60a5fa;
            text-decoration: none;
            margin-bottom: 2rem;
            transition: color 0.2s;
        }
        
        .back-link:hover {
            color: #93c5fd;
        }
        
        article {
            background: #111;
            border: 1px solid #222;
            padding: 3rem;
            border-radius: 8px;
        }
        
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #222;
        }
        
        .series-badge {
            display: inline-block;
            background: #10b98120;
            color: #10b981;
            border: 1px solid #10b981;
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .post-date {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #fff;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .post-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .tag {
            background: #1a1a1a;
            color: #60a5fa;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            border: 1px solid #333;
        }
        
        .post-content {
            color: #d0d0d0;
        }
        
        h2 {
            color: #fff;
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #333;
        }
        
        h3 {
            color: #e0e0e0;
            font-size: 1.3rem;
            margin: 1.5rem 0 1rem;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        ul, ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #1a1a1a;
            color: #60a5fa;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        pre {
            background: #0d0d0d;
            border: 1px solid #222;
            border-radius: 6px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: #d0d0d0;
            display: block;
            line-height: 1.6;
        }
        
        .highlight {
            background: #1a1a1a;
            border-left: 4px solid #10b981;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        
        .highlight strong {
            color: #10b981;
        }
        
        a {
            color: #60a5fa;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        a:hover {
            color: #93c5fd;
            text-decoration: underline;
        }
        
        .info-box {
            background: #0d1b2a;
            border-left: 4px solid #60a5fa;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        
        .warning-box {
            background: #2a1a0d;
            border-left: 4px solid #f59e0b;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        
        .success-box {
            background: #0d2a1b;
            border-left: 4px solid #10b981;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        
        .resources-list {
            background: #0a0a0a;
            padding: 1.5rem;
            border: 1px solid #222;
            border-radius: 6px;
            margin: 1.5rem 0;
        }
        
        .resources-list h3 {
            margin-top: 0;
            color: #60a5fa;
        }
        
        .resources-list ul {
            margin-left: 1.5rem;
        }
        
        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #333;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/blog/" class="back-link">‚Üê Back to Blog</a>
        
        <article>
            <div class="post-header">
                <span class="series-badge">üè† Mi Home Lab DevOps</span>
                <div class="post-date">August 12, 2024</div>
                <h1>n8n Self-Hosted: Instalaci√≥n Completa con Docker Compose</h1>
                <div class="post-tags">
                    <span class="tag">n8n</span>
                    <span class="tag">docker</span>
                    <span class="tag">automation</span>
                    <span class="tag">postgres</span>
                </div>
            </div>
            
            <div class="post-content">
                <h2>üìã Contexto</h2>
                <p>
                    n8n es una poderosa herramienta de automatizaci√≥n de workflows, similar a Zapier o Make (Integromat), 
                    pero con la ventaja de poder ser self-hosted. Despu√©s de montar mi home lab, quer√≠a una plataforma 
                    para automatizar tareas personales sin depender de servicios cloud pagos.
                </p>
                <p>
                    La instalaci√≥n "oficial" con SQLite funciona, pero para un entorno m√°s robusto decid√≠ usar PostgreSQL 
                    como base de datos. Este post documenta el proceso completo, incluyendo todos los problemas que 
                    enfrent√© y c√≥mo los resolv√≠.
                </p>

                <h2>üéØ Objetivo</h2>
                <p>Instalar n8n en mi servidor home lab con:</p>
                <ul>
                    <li>Docker Compose para gesti√≥n de servicios</li>
                    <li>PostgreSQL como base de datos (m√°s robusto que SQLite)</li>
                    <li>Nginx como reverse proxy</li>
                    <li>Persistencia de datos con Docker volumes</li>
                    <li>Health checks y auto-restart</li>
                    <li>Configuraci√≥n lista para producci√≥n personal</li>
                </ul>

                <h2>üõ†Ô∏è Implementaci√≥n</h2>
                
                <h3>Estructura del Proyecto</h3>
                <pre><code>n8n-lab/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ website/
    ‚îî‚îÄ‚îÄ html/</code></pre>

                <h3>Paso 1: Archivo docker-compose.yml</h3>
                <p>Cre√© la configuraci√≥n con tres servicios: PostgreSQL, n8n y Nginx.</p>

                <pre><code>version: '3.8'

services:
  postgres:
    image: postgres:14
    container_name: n8n-postgres
    environment:
      POSTGRES_DB: ${DB_POSTGRES_DATABASE}
      POSTGRES_USER: ${DB_POSTGRES_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - pg_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_POSTGRES_USER}"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped
    networks:
      - n8n-network

  n8n:
    image: n8nio/n8n:latest
    container_name: n8n-app
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      # Database
      DB_TYPE: ${DB_TYPE}
      DB_POSTGRESDB_HOST: postgres
      DB_POSTGRESDB_PORT: 5432
      DB_POSTGRESDB_DATABASE: ${DB_POSTGRES_DATABASE}
      DB_POSTGRESDB_USER: ${DB_POSTGRES_USER}
      DB_POSTGRESDB_PASSWORD: ${DB_PASSWORD}
      
      # n8n config
      N8N_BASIC_AUTH_ACTIVE: true
      N8N_BASIC_AUTH_USER: ${N8N_BASIC_AUTH_USER}
      N8N_BASIC_AUTH_PASSWORD: ${N8N_BASIC_AUTH_PASSWORD}
      N8N_HOST: ${N8N_HOST}
      N8N_PORT: 5678
      N8N_PROTOCOL: https
      WEBHOOK_URL: https://${N8N_HOST}/
      
      # Timezone
      GENERIC_TIMEZONE: America/Argentina/Buenos_Aires
      TZ: America/Argentina/Buenos_Aires
    volumes:
      - n8n_data:/home/node/.n8n
    restart: unless-stopped
    networks:
      - n8n-network

  nginx:
    image: nginx:alpine
    container_name: nginx-web
    ports:
      - "127.0.0.1:8080:80"
    volumes:
      - ./website/html:/usr/share/nginx/html:ro
    restart: unless-stopped
    networks:
      - n8n-network

volumes:
  pg_data:
  n8n_data:

networks:
  n8n-network:
    driver: bridge</code></pre>

                <div class="info-box">
                    <strong>üí° Puntos clave de la configuraci√≥n:</strong><br>
                    ‚Ä¢ <code>depends_on</code> con <code>condition: service_healthy</code> asegura que n8n espere a que PostgreSQL est√© listo<br>
                    ‚Ä¢ <code>DB_POSTGRESDB_HOST: postgres</code> usa el nombre del servicio Docker (no localhost)<br>
                    ‚Ä¢ Nginx solo escucha en <code>127.0.0.1:8080</code> (acceso via Cloudflare Tunnel)<br>
                    ‚Ä¢ Vol√∫menes nombrados para persistencia de datos
                </div>

                <h3>Paso 2: Archivo .env</h3>
                <p>Variables de entorno para configuraci√≥n sensible:</p>

                <pre><code># Database
DB_TYPE=postgresdb
DB_POSTGRES_DATABASE=n8n
DB_POSTGRES_USER=n8n
DB_PASSWORD=tu_password_seguro_aqui

# n8n Authentication
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=tu_n8n_password

# n8n Host
N8N_HOST=n8n.mytechzone.dev</code></pre>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Seguridad:</strong> Nunca subas el archivo <code>.env</code> a GitHub. 
                    Agr√©galo a <code>.gitignore</code> y crea un <code>.env.example</code> con placeholders.
                </div>

                <h3>Paso 3: Iniciar los Servicios</h3>
                <pre><code># Navegar al directorio
cd /home/mytechzone/n8n-lab

# Iniciar servicios
docker compose up -d

# Ver logs
docker compose logs -f n8n

# Verificar estado
docker compose ps</code></pre>

                <h2>üêõ Troubleshooting: El Error ECONNREFUSED</h2>
                <p>
                    Durante la configuraci√≥n inicial, n8n no pod√≠a conectarse a PostgreSQL. 
                    El error en los logs era: <code>Error: connect ECONNREFUSED ::1:5432</code>
                </p>

                <h3>Problema 1: Variables de Entorno Incorrectas</h3>
                <p><strong>S√≠ntoma:</strong> n8n intentaba conectarse a <code>::1</code> (localhost IPv6) en lugar de <code>postgres</code>.</p>
                <p><strong>Causa:</strong> Us√© <code>DB_HOST</code> en lugar de <code>DB_POSTGRESDB_HOST</code>.</p>
                <p><strong>Soluci√≥n:</strong> n8n requiere nombres espec√≠ficos de variables seg√∫n el tipo de base de datos:</p>

                <pre><code># ‚ùå INCORRECTO
DB_HOST: postgres
DB_PORT: 5432
DB_USER: n8n

# ‚úÖ CORRECTO (para PostgreSQL)
DB_POSTGRESDB_HOST: postgres
DB_POSTGRESDB_PORT: 5432
DB_POSTGRESDB_USER: n8n</code></pre>

                <h3>Problema 2: Password con Caracteres Especiales</h3>
                <p><strong>S√≠ntoma:</strong> Logs de PostgreSQL mostraban <code>password authentication failed</code>.</p>
                <p><strong>Causa:</strong> Caracteres especiales en la password sin escapar correctamente.</p>
                <p><strong>Soluci√≥n:</strong> Usar password simple o sin comillas en el archivo <code>.env</code>:</p>

                <pre><code># ‚ùå Puede causar problemas
DB_PASSWORD="MyP@ssw0rd!"

# ‚úÖ Mejor
DB_PASSWORD=mypassword123

# ‚úÖ O si necesitas caracteres especiales
DB_PASSWORD=MyPass_word-123</code></pre>

                <h3>Problema 3: Volumen con Data Antigua</h3>
                <p><strong>S√≠ntoma:</strong> Despu√©s de cambiar credenciales, segu√≠a fallando la autenticaci√≥n.</p>
                <p><strong>Causa:</strong> El volumen de PostgreSQL ten√≠a una base de datos inicializada con las credenciales antiguas.</p>
                <p><strong>Soluci√≥n:</strong> Eliminar el volumen y recrearlo:</p>

                <pre><code># Detener servicios
docker compose down

# Eliminar volumen de PostgreSQL
docker volume rm n8n-lab_pg_data

# Reiniciar con configuraci√≥n limpia
docker compose up -d

# Verificar logs
docker compose logs -f postgres</code></pre>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Importante:</strong> Eliminar el volumen borra TODOS los datos de PostgreSQL. 
                    Solo hazlo si est√°s en fase de setup inicial o tienes backups.
                </div>

                <h2>‚úÖ Verificaci√≥n del Deployment</h2>
                <h3>1. Verificar Containers Corriendo</h3>
                <pre><code>docker compose ps</code></pre>

                <p>Deber√≠as ver algo como:</p>
                <pre><code>NAME            IMAGE              STATUS         PORTS
n8n-postgres    postgres:14        Up (healthy)   5432/tcp
n8n-app         n8nio/n8n:latest   Up             5678/tcp
nginx-web       nginx:alpine       Up             0.0.0.0:8080->80/tcp</code></pre>

                <h3>2. Probar Conexi√≥n a PostgreSQL</h3>
                <pre><code># Desde dentro del container de n8n
docker exec -it n8n-app sh
n8n:~ $ psql -h postgres -U n8n -d n8n
# Si conecta, la configuraci√≥n es correcta</code></pre>

                <h3>3. Acceder a n8n</h3>
                <p>Si tienes Cloudflare Tunnel configurado:</p>
                <pre><code># URL: https://n8n.mytechzone.dev/
# Credenciales: Las de N8N_BASIC_AUTH_USER y PASSWORD</code></pre>

                <h2>üîß Configuraci√≥n Post-Instalaci√≥n</h2>
                <h3>Comandos √ötiles</h3>
                <pre><code># Ver logs en tiempo real
docker compose logs -f n8n

# Reiniciar solo n8n
docker compose restart n8n

# Ver uso de recursos
docker stats n8n-app n8n-postgres

# Backup de la base de datos
docker exec n8n-postgres pg_dump -U n8n n8n > backup_$(date +%Y%m%d).sql

# Entrar al container de n8n
docker exec -it n8n-app sh</code></pre>

                <h3>Health Check Manual</h3>
                <pre><code># Verificar PostgreSQL
docker exec n8n-postgres pg_isready -U n8n

# Verificar n8n responde
curl http://localhost:5678/healthz</code></pre>

                <h2>üìä Recursos del Sistema</h2>
                <p>En mi servidor (notebook con 8GB RAM), el stack consume aproximadamente:</p>
                <ul>
                    <li><strong>PostgreSQL:</strong> ~50-80 MB RAM, CPU m√≠nima en idle</li>
                    <li><strong>n8n:</strong> ~150-200 MB RAM, CPU variable seg√∫n workflows activos</li>
                    <li><strong>Nginx:</strong> ~5-10 MB RAM, CPU m√≠nima</li>
                </ul>

                <div class="success-box">
                    <strong>Total:</strong> ~200-300 MB RAM en idle. Muy razonable para un home lab.
                </div>

                <h2>üí° Optimizaciones y Best Practices</h2>
                <h3>1. Configurar Log Rotation</h3>
                <p>Para evitar que los logs llenen el disco:</p>
                <pre><code># En docker-compose.yml, agregar a cada servicio:
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"</code></pre>

                <h3>2. Backups Automatizados</h3>
                <p>Script bash para backup diario:</p>
                <pre><code>#!/bin/bash
# backup_n8n.sh

BACKUP_DIR="/home/mytechzone/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

# Backup PostgreSQL
docker exec n8n-postgres pg_dump -U n8n n8n | \
  gzip > "$BACKUP_DIR/n8n_db_$DATE.sql.gz"

# Backup workflows (volumen de n8n)
docker run --rm -v n8n-lab_n8n_data:/data -v "$BACKUP_DIR":/backup \
  alpine tar czf /backup/n8n_data_$DATE.tar.gz /data

# Limpiar backups viejos (mantener √∫ltimos 7)
find "$BACKUP_DIR" -name "n8n_*" -mtime +7 -delete

echo "‚úì Backup completado: $DATE"</code></pre>

                <h3>3. Monitoreo con Health Checks</h3>
                <p>Agregar health checks a n8n en docker-compose.yml:</p>
                <pre><code>n8n:
  # ... resto de config ...
  healthcheck:
    test: ["CMD", "wget", "--spider", "http://localhost:5678/healthz"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s</code></pre>

                <h2>üöÄ Workflows de Ejemplo</h2>
                <p>Una vez n8n est√© funcionando, estos son algunos workflows √∫tiles para empezar:</p>

                <h3>1. Backup Autom√°tico a Cloud</h3>
                <p>Workflow que toma backups diarios y los sube a AWS S3 o Google Drive.</p>

                <h3>2. Monitoreo de Website</h3>
                <p>Chequea tu sitio cada 5 minutos y env√≠a alerta si est√° ca√≠do.</p>

                <h3>3. RSS to Email</h3>
                <p>Lee feeds RSS de tus blogs tech favoritos y env√≠a resumen semanal.</p>

                <h3>4. GitHub Activity Tracker</h3>
                <p>Notificaciones cuando alguien da star o fork a tus repos.</p>

                <div class="resources-list">
                    <h3>üìö Recursos √ötiles</h3>
                    <ul>
                        <li><a href="https://docs.n8n.io/" target="_blank">n8n Official Documentation</a></li>
                        <li><a href="https://docs.n8n.io/hosting/installation/docker/" target="_blank">n8n Docker Installation Guide</a></li>
                        <li><a href="https://docs.n8n.io/hosting/configuration/environment-variables/" target="_blank">n8n Environment Variables Reference</a></li>
                        <li><a href="https://community.n8n.io/" target="_blank">n8n Community Forum</a></li>
                        <li><a href="https://www.postgresql.org/docs/14/index.html" target="_blank">PostgreSQL 14 Documentation</a></li>
                    </ul>
                </div>

                <h2>üí≠ Lecciones Aprendidas</h2>
                <ul>
                    <li><strong>Variables de entorno espec√≠ficas:</strong> n8n requiere nombres exactos de variables seg√∫n el tipo de DB. Leer la documentaci√≥n ahorra horas de troubleshooting.</li>
                    <li><strong>Health checks son cr√≠ticos:</strong> Usar <code>depends_on</code> con <code>condition: service_healthy</code> evita race conditions en el startup.</li>
                    <li><strong>Vol√∫menes persisten data:</strong> Si cambias credenciales, puede que necesites recrear vol√∫menes para aplicar los cambios.</li>
                    <li><strong>Logs son tu mejor amigo:</strong> <code>docker compose logs -f</code> te da toda la informaci√≥n necesaria para debuggear.</li>
                    <li><strong>Backups no son opcionales:</strong> Incluso en un home lab, implementa backups desde el d√≠a 1.</li>
                </ul>

                <h2>üîÑ Actualizar n8n</h2>
                <p>Para actualizar a la √∫ltima versi√≥n:</p>
                <pre><code># Pull nueva imagen
docker compose pull n8n

# Recrear container
docker compose up -d n8n

# Verificar versi√≥n
docker exec n8n-app n8n --version</code></pre>

                <h2>‚úÖ Resultado Final</h2>
                <p>Despu√©s de resolver todos los problemas, tengo:</p>
                <ul>
                    <li>‚úÖ n8n corriendo establemente 24/7</li>
                    <li>‚úÖ PostgreSQL con persistencia de datos</li>
                    <li>‚úÖ Acceso seguro via Cloudflare Tunnel</li>
                    <li>‚úÖ Health checks y auto-restart configurados</li>
                    <li>‚úÖ Backups automatizados</li>
                    <li>‚úÖ Configuraci√≥n lista para escalar</li>
                </ul>

                <div class="highlight">
                    <strong>üéØ Mi instancia n8n:</strong><br>
                    ‚Ä¢ URL: <a href="https://n8n.mytechzone.dev">n8n.mytechzone.dev</a><br>
                    ‚Ä¢ Uptime: ~30 d√≠as sin problemas<br>
                    ‚Ä¢ Workflows activos: 5+<br>
                    ‚Ä¢ Costo: $0 (self-hosted)
                </div>

                <h2>üöÄ Pr√≥ximos Pasos</h2>
                <p>Mejoras que planeo implementar:</p>
                <ol>
                    <li>Integrar con Prometheus para m√©tricas avanzadas</li>
                    <li>Configurar alertas v√≠a Telegram para fallos de workflows</li>
                    <li>Implementar OAuth2 en lugar de Basic Auth</li>
                    <li>Agregar Redis para mejor performance con webhooks</li>
                    <li>Crear library de workflows reutilizables</li>
                </ol>

                <h2>üí≠ Conclusi√≥n</h2>
                <p>
                    n8n self-hosted es una excelente adici√≥n a cualquier home lab. Aunque la configuraci√≥n inicial 
                    tiene sus desaf√≠os (especialmente con PostgreSQL), una vez funcionando es extremadamente estable 
                    y potente.
                </p>
                <p>
                    El troubleshooting del error <code>ECONNREFUSED</code> me ense√±√≥ mucho sobre Docker networking, 
                    environment variables, y la importancia de leer documentaci√≥n oficial. Espero que esta gu√≠a 
                    te ahorre las horas de frustraci√≥n que yo experiment√©.
                </p>
                <p>
                    Si est√°s considerando automatizar tareas personales o profesionales, n8n es una inversi√≥n de 
                    tiempo que vale totalmente la pena. Y con esta configuraci√≥n, tienes una base s√≥lida para 
                    crear workflows incre√≠bles.
                </p>
            </div>
        </article>
        
        <footer>
            <p>¬© 2024 Kevin Romero | <a href="/">Home</a> | <a href="/blog/">Blog</a> | <a href="https://github.com/romerok9">GitHub</a></p>
        </footer>
    </div>
</body>
</html>

